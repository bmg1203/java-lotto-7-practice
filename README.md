# java-lotto-precourse

***로또를 발행해 당첨 추첨을 진행한다!***

> ## 목차
> 1. [핵심 개념](#핵심-개념)
> 2. [기능 목록](#service--domain)
>   - [Presentation](#presentation)
>   - [Service & Domain](#service--domain)
>   - [명시되지 않은 요구사항 처리](#명시되지-않은-요구사항-처리)
> 3. [리팩토링](#리팩토링)
> 4. [docs](#docs)

# 핵심 개념
| 핵심 개념  |
|:------:|
| **로또** |
| **당첨** |

# 기능 목록
## Presentation
- [x] 구입금액을 입력 받는다
  - 금액의 세 자리 쉼표 구분, "원"추가를 허용한다 
  - 시스템 예외: 입력이 `null`인 경우 
  - 사용자 예외: 입력이 빈 문자열 또는 공백으로 이루어진 문자인 경우
  - 사용자 예외: 입력이 구입금액 패턴에 맞지 않는 경우
  - 사용자 예외: 입력이 long 범위를 넘어가는 경우
- [x] 로또구매 요청을 보낸다
- [x] 발행한 로또 수량과 번호를 출력한다
- [x] 당첨 번호를 입력 받는다
  - 당첨 번호 구분자 쉼표 뒤 공백 한 칸을 허용한다
  - 시스템 예외: 입력이 `null`인 경우
  - 사용자 예외: 입력이 빈 문자열 또는 공백으로 이루어진 문자인 경우
  - 사용자 예외: 입력이 당첨 번호 패턴에 맞지 않는 경우
- [x] 보너스 번호를 입력 받는다
  - 시스템 예외: 입력이 `null`인 경우
  - 사용자 예외: 입력이 빈 문자열 또는 공백으로 이루어진 문자인 경우
  - 사용자 예외: 입력이 구입금액 패턴에 맞지 않는 경우 
- [x] 로또추첨 요청을 보낸다
- [x] 당첨 결과를 출력한다
  - 금액은 원화 구분 규격을 준수한다
  - 수익률은 소수점 둘째 자리에서 반올림해 소수점 첫째 자리까지 보여준다

## Service & Domain
- [x] 숫자들을 생성한다
  - 외부 API를 사용해 랜덤 생성
    - 시스템 예외: 시작 범위가 더 큰 경우
    - 시스템 예외: 끝 범위가 `Integer.MAX_VALUE`와 같은 경우
    - 시스템 예외: 범위 값의 개수가 `Integer.MAX_VALUE` 이상인 경우
    - 시스템 예외: 범위 값의 개수가 생성하려는 숫자들의 개수 미만인 경우
    - 시스템 예외: 생성 개수가 0개 미만인 경우
  - 입력 값을 사용해 수동 생성
    - 사용자 예외: 입력 값 중 int 범위를 초과한 경우
- [x] 로또를 생성한다
  - 사용자 예외: 로또 번호가 6개가 아닌 경우
  - 사용자 예외: 로또 번호가 1~45가 아닌 경우
  - 사용자 예외: 로또 번호에 중복이 존재하는 경우
- [x] 발행된 로또를 저장한다
- [x] 당첨 번호와 보너스 번호를 추첨한다
  - 사용자 예외: 당첨 번호가 6개가 아닌 경우 
  - 사용자 예외: 당첨 번호가 1~45가 아닌 경우 
  - 사용자 예외: 당첨 번호에 중복이 존재하는 경우
  - 사용자 예외: 당첨 번호에 보너스 번호가 중복되는 경우
- [x] 당첨을 확인한다
  - 보너스 번호 일치는 당첨 번호 일치와 상관없다
- [x] 등수를 당첨 통계에 저장한다
- [x] 수익률을 계산한다
  - 수익률은 정밀한 계산을 위해 최대 16자리로 제한해 계산한다
  - 16자리를 넘어가는 순환 소수가 발생하면 마지막 자리 밑 17자리에서 반올림한다

## 명시되지 않은 요구사항 처리
- 로또 번호를 갖는 값 객체가 필요하다
  - 근거: 로또 번호는 1~45 사이의 범위를 갖는 도메인 규칙이 있다
  - 근거: 로또를 발행할 때 로또 번호는 반복되서 사용되어 불필요한 객체 생성을 줄여야 한다
- 구매 금액은 최대 100,000원까지 가능하다
  - 근거: 구매 가능한 로또의 개수가 많으면 도박과 같음 -> 사용자의 재정적 피해 방지와 건전한 여가 활동 고려
  - 근거: 공정성 -> 제한이 없다면 사용자의 자산에 따라 구매 가능한 개수가 천차만별, 로또는 모든 참여자에게 비교적 균등한 기회를 제공
  - 근거: 시스템 한계 -> 만약 21억 까지 구매가 가능하다면? 210만장 로또는 약 1260만 개의 번호가 생성됨, 현재 출력 방식에서 문제 
  - 법적 근거: 만약 실제로 로또 서비스를 출시한다면, 복권기금법 시행규칙을 따라야함, 여기서는 1,000원 이라는 화폐 단위를 사용(포인트가 아님)
- 사용자 입력 시 포스텔의 법칙(Postel's law) 적용
  - 사용자의 입력을 공감하는 태도로 유연하게 처리
  - 구입 금액 입력: 숫자 표준 규격인 쉼표 구분자를 사용해 입력한 경우, 화폐 단위를 사용해 입력한 경우 (ex. 1,000, 8000원, 10,000원)
  - 당첨 번호 입력: 쉼표 사이의 공백 1칸을 사용해 입력한 경우 (ex. "1, 2, 3, 4, 5, 6")

# 리팩토링
- `LottoRule` enum 클래스 삭제 -> 로또 번호의 범위, 로또 가격, 로또 크기를 도메인 내부에서 관리
  - Lotto의 숫자 범위(1~45), Lotto 크기, 가격. 즉, 로또 규칙은 언제든 변할 수 있다
  - 만약 규칙 값을 `enum`로 관리하면 정책의 변화 때 이곳저곳에 퍼진 `enum`을 관리하기 어려움
  - 단일 책임 원칙 위반: 클래스가 수정될 이유가 하나여야하는데, `enum` 로또 규칙이 변경되면 이곳저곳에서 수정이 일어남
  - 변경의 영향을 가능한 해당 문제 영역 내로 한정
- 오류 메시지 출력의 책임을 결과 화면에게 부여
  - 사용자 입력의 잘못으로 생성된 오류의 메시지는 입력의 결과
  - 결과 화면에서 처리
  - `[ERROR]`는 결과 화면의 책임. 예외를 던지는 곳에서 넣어줄 필요가 없음
- 수익률 출력은 결과 화면의 책임, 당첨 결과 도메인은 정확한 값 계산에 집중
  - 결과 화면에서 소수점 아래 둘째 자리에서 반올림해 출력한다
  - 수익률 계산을 처리하는 당첨 통계 도메인은 `MathContext.DECIMAL64`로 순환 소수 문제를 예방한다
    - 전체 자리수를 16개로 제한: 20억(2 * 10^9) / 1,000 -> 2 * 10^6 -> 정수 부분은 최대 7자리, 정확한 소수 값 제공을 위해 최소 9개 제공
  - 5,000원 당첨, 99,000원 구매 시 0.050505050505051 -> 16자리로 제한

# docs
- [개념과 격벽](https://github.com/ykmxxi/java-lotto-7/blob/ykmxxi/docs/concept-bulkhead.md)
  - 프로그램을 지탱하는 핵심적인 것들인 개념과, 개념을 통제하고 제어하는 요소인 격벽에 대한 설명이 존재합니다
  - 미션 요구사항(기능, 프로그래밍 요구사항) 분석 내용이 존재합니다
- [피드백 분석과 회고](https://github.com/ykmxxi/java-lotto-7/blob/ykmxxi/docs/feedback.md)
  - 공통 피드백과 코드 리뷰를 통해 받은 피드백 분석 내용이 존재합니다
- [이번 미션의 목표](https://github.com/ykmxxi/java-lotto-7/blob/ykmxxi/docs/goals.md)
  - 이번 미션을 진행하면서 스스로 설정한 목표가 존재합니다
  - 스스로의 목표, 우테코가 제공해준 목표, 일일 목표
- [리팩토링](https://github.com/ykmxxi/java-lotto-7/blob/ykmxxi/docs/refactoring.md)
  - 미션에서 사용할 저만의 커스텀 3-tier 아키텍처에 대한 설명이 존재합니다
  - 어떤 관점에서 리팩토링을 진행했는지 존재합니다
  - 작은 단위의 리팩토링 진행 과정이 존재합니다

