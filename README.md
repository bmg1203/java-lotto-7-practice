# java-lotto-precourse

---

# 1. 기능 요구 사항

### 로또 번호의 숫자 범위는 1~45까지이다.

### 1개의 로또를 발행할 때 중복되지 않는 6개의 숫자를 뽑는다

### 당첨 번호 추첨 시 중복되지 않는 숫자 6개와 보너스 번호 1개를 뽑는다.

### 당첨은 1등부터 5등까지 있다. 당첨 기준과 금액은 아래와 같다.

#### 1등: 6개 번호 일치 / 2,000,000,000원

#### 2등: 5개 번호 + 보너스 번호 일치 / 30,000,000원

#### 3등: 5개 번호 일치 / 1,500,000원

#### 4등: 4개 번호 일치 / 50,000원

#### 5등: 3개 번호 일치 / 5,000원

### 로또 구입 금액을 입력하면 구입 금액에 해당하는 만큼 로또를 발행해야 한다.

### 로또 1장의 가격은 1,000원이다.

### 당첨 번호와 보너스 번호를 입력받는다.

### 사용자가 구매한 로또 번호와 당첨 번호를 비교하여 당첨 내역 및 수익률을 출력하고 로또 게임을 종료한다.

### 사용자가 잘못된 값을 입력할 경우 IllegalArgumentException을 발생시키고, "[ERROR]"로 시작하는 에러 메시지를 출력 후 그 부분부터 입력을 다시 받는다.

### Exception이 아닌 IllegalArgumentException, IllegalStateException 등과 같은 명확한 유형을 처리한다.

---

# 2. 전체적 설계 방향

## 책임 연쇄 패턴을 이용하여 구현

#### 책임 연쇄 패턴 변형

- 하나의 핸들러는 nextHanlder를 갖는다.
- validation에 포함하는 핸들러는 prevHandler를 갖는다.
- 입력 다음 validation을 추가하여, 입력값을 검증한다.
- `validation에서 입력값 예외 발생 시 prevHandler를 실행시켜, 입력으로 돌아갈 수 있다.`

## 핸들러 토큰

#### 핸들러 토큰 구조

- 핸들러 토큰은 TokenType(어떤 핸들러에서 사용되는가?, TokenType)과 Content(실질적인 데이터, Object)를 갖는다.
- 토큰은 입력과 생성된 값들을 다른 핸들러들로 이동시킬 수 있는 유일한 객체이다.
- HashMap<TokenType, Object> 형태로 TokenType에 따라, 모든 타입의 값을 가져올 수 있다.
- Object에서 특정 타입으로 캐스팅하기 위해서는 클래스 타입이 필요하다.
- `안전한 캐스팅을 위해서 DTO를 만들어, 핸들러 토큰에 추가해야한다.`

#### 핸들러 토큰 타입

- 핸들러 토큰 타입을 해시 맵의 키로 하여, DTO를 가져올 수 있다.
    - (입력) : 사용자 입력받은 값을 담는다.
    - (생성) : 프로그램에서 입력값을 통해 생성한 값을 담는다.
- `(입력) 구매 금액을 담는 DTO`
- `(생성) 구매한 로또들을 리스트로 담는 DTO`
- `(입력) 당첨 번호와 보너스 번호를 담는 DTO`
- `(생성) 해시맵으로 당첨 등수와 해당 등수의 갯수를 담는 DTO`
- `(생성) 계산된 수익률을 문자열로 담는 DTO`
- `(생성) 입력값에서 에러가 있을 시 생성된다. 에러가 생성되었는지만, 확인하기 때문에 값은 null이다.`

## 책임 순서

#### 1. 구매 금액 입력

#### 2. 입력 값 검증

- 입력 값에 문제가 있다면, 입력으로 돌아감

#### 3. 구매 금액을 통해 여러개의 로또 생성

#### 4. 여러개의 로또 출력

#### 5. 당첨 번호, 보너스 번호 입력

#### 6. 당첨 번호, 보너스 번호 검증

- 입력 값에 문제가 있다면, 입력으로 돌아감

#### 6. 당첨 번호, 보너스 번호를 통해 당첨 결과 생성

#### 7. 당첨 결과 출력

#### 8. 당첨 결과와 구매 급액을 통해 수익률 생성

#### 9. 수익률 출력

#### 10. EndHandler를 통해 핸들러 토큰 생명주기 끝남 체크

- `(주의)토큰 생명주기 체크가 없을 시 책임 연쇄는 무한 루프에 빠지거나 알 수 없는 에러가 날 수 있음`

---

# 3. 기능 구현 고려 사항(계속해서 추가 가능)

## 핸들러(책임)

### 1. 핸들러 토큰 구현

- {TokenType, Object} 형식의 데이터들을 저장한다.
- Content를 가져올 때, 각 핸들러에 맞는 형 변환이 필요. **제네릭 타입을 이용해, 안전하게 캐스팅.**
- TokenType으로 가져온 DTO가 변환 할 클래스 타입과 맞지 않다면, 캐스팅 예외 발생.
- 검증 결과로 예외가 있는지 확인하기 위한 메서드 필요.
- 입력 값으로 돌아갔을때, 발생된 예외를 삭제하기 위한 메서드 필요.
- 마지막 EndHandler까지 도달했는지를 확인하기 위한 메서드 필요.

### 2. 토큰 타입 구현

- `(입력) 구매 금액을 담는 DTO`
- `(생성) 구매한 로또들을 리스트로 담는 DTO`
- `(입력) 당첨 번호와 보너스 번호를 담는 DTO`
- `(생성) 해시맵으로 당첨 등수와 해당 등수의 갯수를 담는 DTO`
- `(생성) 계산된 수익률을 문자열로 담는 DTO`
- `(생성) 입력값에서 에러가 있을 시 생성된다. 에러가 생성되었는지만, 확인하기 때문에 값은 null이다.`

### 3. 기본 로또 핸들러, EndHandler 구현

#### 기본 핸들러

- 모든 핸들러들은 이 기본 로또 핸들러를 상속해야한다.
- 이전, 이후 핸들러 주소값을 포함한다.
- 진행 메서드를 오버라이딩해서 각 핸들러의 책임을 구현한다.
- 진행 메서드 이후 결과 토큰을 받아, 진행 여부를 판단한다.(다음 핸들러가 있는가?, 토큰이 유효한가?)

#### EndHandler

- 가장 마지막에 추가해야 할 핸들러
- 핸들러 토큰을 유효하지 않음으로 업데이트

### 4. 로또 구매 기능(입력, 검증, 구매과정, 출력) - 입력, 구매과정, 출력 구현 후 검증 구현

#### 입력

- 핸들러 토큰을 파라미터로, 받는다.
- 입력받고, DTO로 생성해 핸들러 토큰에 추가.
- 핸들러 토큰 리턴
- key 값으로 `TokenType enum을 꼭 사용하기`

**생성됨 `(입력) 구매 금액을 담는 DTO`

#### 검증

- 핸들러 토큰에서 구매 금액 DTO을 가져와 구매 금액 문자열을 검증
- `형식 : 숫자만 들어가야한다.`
- `범위 : 1000원부터 100000까지 가능.`
- `단위 : 1000원 단위`
- 위의 검증 객체들은 Factory에 의해 순서에 맞게 생성됨
- 만약 검증에서 `에러가 발생`할 경우 핸들러 토큰에 에러 타입을 저장하고, `prevHandler를 실행`시킨다.

**사용함 `(입력) 구매 금액을 담는 DTO`

#### 구매 과정

- `검증` 이후 구매 과정 실행
- 핸들러 토큰에서 구매 금액 DTO를 받아 구매 금액 정보를 얻어오고, 이로 로또들의 갯수를 구한다.
- `로또 생성기`를 통해 for문을 돌려 List<Lotto> 형식으로 여러개의 로또들을 생성
- DTO에 생성된 로또들을 저장하고, 핸들러 토큰에 담아 반환
- `로또 생성기`는 요구사항에 나와있던, Randoms의 메서드를 사용해 List<Integer>로 로또 하나를 생성

**사용함 `(입력) 구매 금액을 담는 DTO`

**생성됨 `(생성) 구매한 로또들을 리스트로 담는 DTO`

#### 출력

- `구매 과정`에서 생성된 로또들 DTO에서 로또 리스트를 출력한다.

**사용함 `(생성) 구매한 로또들을 리스트로 담는 DTO`

### 5. 로또 등수 계산 기능

#### 입력

- 문자열 형식의 당첨 번호(ex."1,2,3,4,5,6")와 보너스 번호를 입력 받는다.
- 입력 받고, 문자열 형식의 당첨 번호와 보너스 번호를 가진 DTO를 생성해 핸들러 토큰에 추가.
- key 값으로 `TokenType enum을 꼭 사용하기`

**생성됨 `(입력) 당첨 번호와 보너스 번호를 담는 DTO`

#### 검증

- `당첨 번호 형식: 맨앞에는 숫자가 와야함. 숫자 + ","가 번갈아가며 각 6개, 5개가 나와야하고, 숫자로 끝나야함`
- `당첨 번호 갯수: 총 6개의 숫자가 와야함`
- `당첨 번호 범위: 1이상 45 이하`
- `보너스 번호 형식: 숫자 하나만 와야함`
- `보너스 번호 범위: 1이상 45 이하`
- `당첨, 보너스 번호 중복: 중복되는 번호가 있으면 안됨`
- 위의 검증 로직 객채들은 Factory에 의해 순서에 맞게 생성됨
- 만약 검증에서 `에러가 발생`할 경우 핸들러 토큰에 에러 타입을 저장하고, `prevHandler를 실행`시킨다.

**사용함 `(입력) 당첨 번호와 보너스 번호를 담는 DTO`

#### 등수 계산 과정

- 핸들러 토큰에서 당첨 번호와 보너스 번호를 담는 DTO를 가져와 당첨 번호와 보너스 번호를 가져옴
- 핸들러 토큰에서 구매한 로또들을 담는 DTO를 가져와 로또들을 가져옴
- 당첨 번호와 보너스 번호, 구매한 로또들을 비교하여 등수를 해시 맵에 담음
- 해시 맵에 담긴 등수를 DTO에 담아서 핸들러 토큰에 추가
- 핸들러 토큰 반환

**사용함 `(입력) 당첨 번호와 보너스 번호를 담는 DTO`

**사용함 `(생성) 구매한 로또들을 리스트로 담는 DTO`

**생성됨 `(생성) 해시맵으로 당첨 등수와 해당 등수의 갯수를 담는 DTO`

#### 출력

- 핸들러 토큰에서 해시 맵의 등수를 일괄 출력

**사용함 `(생성) 해시맵으로 당첨 등수와 해당 등수의 갯수를 담는 DTO`
