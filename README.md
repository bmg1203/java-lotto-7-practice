# java-lotto-precourse

# 💬 우테코 프리코스 3주차 - 로또

**`간단한 로또 발매기를 구현한다.`**

---

## 📝 기능 요구 사항 정리

### 기능 요구 사항
- 로또 번호의 숫자 범위는 `1` 부터 `45`까지 이다.
- 로또 번호를 발행할 때, **중복되지 않는** `6`개의 숫자를 뽑는다.
- 당첨 번호 추첨시, **중복되지 않는** `6`개의 숫자와 보너스 번호 `1`개를 뽑는다.
- 당첨은 1등부터 5등까지 있으며, 당첨 기준과 금액은 아래와 같다.
  - 1등 : `6`개 번호 일치 /  `2,000,000,000원`
  - 2등 : `5`개 번호 일치 + 보너스 번호 일치 / `30,000,000원`
  - 3등 : `5`개 번호 일치 / `1,500,000원`
  - 4등 : `4`개 번호 일치 / `50,000원`
  - 5등 : `3`개 번호 일치 / `5,000원`
- 로또 1장의 가격은 `1,000원`이며, 구입 금액 만큼의 로또가 발행되어야 한다.

### 입출력 진행 시나리오 및 관련 요구 사항

- [x] 애플리케이션이 시작되면, **로또 구입 금액**을 **입력**받는다.
  - 입력은 `Console.readLine()`을 통해 입력받는다.
  - 구입 금액은 **`1000`원 단위**로 입력받으며, 올바른 입력이 아닐 경우 **예외 처리**한다.

- [x] 발행한 **로또 수량** 및 각 로또의 **번호**를 **출력**한다. 
  - 로또 번호는 **오름차순으로 정렬**하여 보여준다.

- [x] **당첨 번호**를 **입력**받는다.
  - 입력은 `Console.readLine()`을 통해 입력받는다.
  - 번호는 **쉼표`(,)`를 기준으로 구분**한다.

- [x] **보너스 번호**를 **입력**받는다.
  - 입력은 `Console.readLine()`을 통해 입력받는다.

- [x] **당첨 내역**을 **출력**한다.
  - 당첨 내역은 **5등부터 1등까지 순서대로 출력**하며, **당첨된 로또가 없더라도 출력**한다.
  - 당첨 기준에 따른 **일치해야 하는 번호 갯수, 당첨 금액**, 그리고 **당첨된 로또의 갯수**를 출력한다.

- [x] **수익률**을 **출력**한다.
  - 수익률은 **소수점 둘째 자리에서 반올림**한다. (ex. 100.0%, 51.5%, 1,000,000.0%)

- [x] 사용자가 잘못된 값을 입력할 경우, `IllegalArgumentException`을 발생시키고, `[ERROR]`로 시작하는 에러메세지를 출력 후,
**그 부분부터 입력을 다시 받는다**.
  - `Exception`이 아닌 `IllegalArgumentException`, `IllegalStateException`등과 같은 명확한 유형을 처리한다.

---

## ✏️ 구현할 기능 목록

### 1. 손님이 로또 구매를 위해 금액을 지불한다.
- [x] 구매 금액 입력
  - [x] `구입 금액을 입력해 주세요.`라는 문구를 출력
  - [x] 구입 금액을 `Console.readLine()`메서드를 활용하여 입력받음
- [x] 구매 금액 입력 유효성 검사
  - [x] 입력된 구입 금액이 `1,000원` 단위의 정상 입력인지 검사
  - [x] 입력이 올바르지 않다면, 구매 금액 입력부터 다시 과정을 시작

### 2. 상점은 받은 구매 금액 만큼의 로또를 발급한다.
- [x] 로또 번호 발급
  - [x] 발급하기로 한 하나의 로또 당 **중복되지 않는** 6개의 숫자 발급
  - [x] 로또의 랜덤 번호는 `Randoms.pickUniqueNumbersInRange()`를 활용하여 발급
  - [x] 6개의 숫자를 가지고 로또 객체의 생성을 요청
- [x] 로또 객체 생성 및 저장
  - [x] 발급된 6개의 숫자를 기반으로, `Lotto` 객체를 생성
  - [x] 생성된 객체들을 `Repository`에 저장

### 3. 손님은 본인이 수령한 로또의 번호를 확인한다.
- [x] 구입 로또 번호 출력
  - [x] 구입한 로또의 갯수를 기반으로 `N개를 구매했습니다.`라는 문구를 출력
  - [x] 정렬된 각 로또의 번호들을 출력

### 4. 상점에서 이번 주 당첨 번호를 설정한다.
- [x] 당첨 번호 입력
    - [x] `당첨 번호를 입력해 주세요`라는 문구를 출력
    - [x] 당첨 번호를 `Console.readLine()`메서드를 활용하여 입력받음
- [x] 당첨 번호 입력 유효성 검사
    - [x] 입력된 당첨 번호가 쉼표`(",")`로 구분된 `6`개의 숫자인지 검사
    - [x] 각 숫자가 `1`부터 `45` 사이의 숫자인지 검사
    - [x] 각 숫자가 중복되지 않는지 검사
    - [x] 입력이 올바르지 않다면, 당첨 번호 입력부터 다시 과정을 시작

### 5. 상점에서 이번 주 보너스 번호를 설정한다.
- [x] 보너스 번호 입력
    - [x] `보너스 번호를 입력해 주세요`라는 문구를출력
    - [x] 보너스 번호를 `Console.readLine()`메서드를 활용하여 입력받음
- [x] 보너스 번호 입력 유효성 검사
    - [x] 입력된 보너스 번호가 `1`부터 `45`사이의 숫자인지 검사
    - [x] 입력된 보너스 번호가 사전에 입력된 당첨 번호와 중복되지 않는지 검사
    - [x] 입력이 올바르지 않다면, 보너스 번호 입력부터 다시 과정을 시작

### 6. 손님은 로또의 당첨 여부의 조회를 상점에게 요청한다.
- [x] 당첨 통계 출력
  - `당첨 통계` 와 `---` 라는 문구를 시작으로 통계 출력을 시작한다
  - 5등부터 1등까지 일치해야 하는 갯수, 상금, 당첨된 갯수를 출력한다

### 7. 손님은 본인의 수익률을 계산한다.
- [x] 수익률 계산
  - [x] 손님은 당첨된 로또들을 기반으로 수익률의 계산을 한다
    - [x] 수익률을 계산하는 방식은 (당첨 금액 - 구매 금액) / 100 으로 계산한다
    - [x] 수익률은 소수점 둘째자리에서 반올림한다
    - [x] `총 수익률은 N%입니다`와 같이 출력한다

---

## 😈 예외 사항
사용자가 잘못된 값을 입력할 경우, `IllegalArgumentException`을 발생시키고, `[ERROR]`로 시작하는 에러메세지를 출력 후,
**그 부분부터 입력을 다시 받으며**, `Exception`이 아닌 **명확한 예외 유형**을 처리한다.

- `NumberFormatException`인 경우 (문자열을 숫자로 변환할 때 잘못된 입력일 경우)
  - [x] 구매 금액을 입력할 때, 숫자가 아닌 내용이 입력될 수 없다.
  - [x] 당첨번호를 입력할 때, 숫자가 아닌 내용이 입력될 수 없다.
  - [x] 보너스 번호를 입력할 때, 숫자가 아닌 내용이 입력될 수 없다.


- `IllegalArgumentException`인 경우 (메서드가 매개변수로 잘못된 값이 전달되었을 때 발생)
  - [x] 구매 금액의 단위는 `1,000`원 단위로 입력되어야 한다.(0도 허용하지 않는다)
  - [x] 당첨 번호는 `1`과 `45`사이의 숫자가 입력되어야 한다.
  - [x] 당첨 번호는 **중복을 허용하지 않는다**.
  - [x] 당첨 번호를 구분하는 문자는 쉼표`(,)`여야 한다.
  - [x] 당첨 번호는 총 `6`개의 번호가 입력되어야 한다.
  - [x] 보너스 번호는 `1`과 `45`사이의 숫자가 입력되어야 한다.
  - [x] 보너스 번호는 **당첨 번호와의 중복을 허용하지 않는다**.
  - [x] 구매 금액, 당첨 번호, 보너스 번호는 공통적으로 아래의 사항을 허용하지 않는다.
    - [x] 공백(whitespace) 혹은 무입력 `("")`은 입력될 수 없다.
    - [x] 소수가 입력될 수 없다.
    - [x] 0보다 작은 수(0 혹은 음수)가 입력될 수 없다.
    - [x] `+`기호가 포함될 수 없다.
    - [x] 앞 뒤 공백이 포함될 수 없다.
    - [x] 맨 앞에 0이 포함될 수 없다.

---

### ⁉️ 고려해야할 사항
- [x] 1, 2주차 공통 피드백과 프로그래밍 요구사항을 준수한다.
- [x] indent의 depth가 `3`을 넘지 않도록 구현한다.
- [x] 메서드가 한 가지 일만 하도록 최대한 작게 구현한다.
- [x] 클래스는 `상수, 멤버 변수, 생성자, 메서드` 순으로 작성한다.
- [x] 메서드의 길이가 `15`라인을 넘지 않도록 구현한다.
- [x] `else`예약어와 `switch/case`문을 사용하지 않는다.
- [x] Java Enum을 적용하여 프로그램을 구현한다.
- [x] 구현한 기능에 대한 단위 테스트를 작성한다. (단, UI로직은 제외한다.)
- [x] 제공된 `Lotto` 클래스를 사용하여 구현한다.
  - 인스턴스 변수의 추가는 허용하지 않는다.
  - `numbers`의 접근제어자인 `private`는 변경할 수 없다.
  - `Lotto`의 패키지 변경은 허용한다.

---

## 🖥️ 예시

```console
구입금액을 입력해 주세요.
8000

8개를 구매했습니다.
[8, 21, 23, 41, 42, 43] 
... (총 8개의 로또 출력)
[1, 3, 5, 14, 22, 45]

당첨 번호를 입력해 주세요.
1,2,3,4,5,6

보너스 번호를 입력해 주세요.
7

당첨 통계
---
3개 일치 (5,000원) - 1개
4개 일치 (50,000원) - 0개
5개 일치 (1,500,000원) - 0개
5개 일치, 보너스 볼 일치 (30,000,000원) - 0개
6개 일치 (2,000,000,000원) - 0개
총 수익률은 62.5%입니다.
```

---

## 🤔 구현 과정

### 생각 해보기(Before)

#1 ~~이전에 사용했던 `BigInteger`를 활용하면 좋을지, 아니면 `Long`을 최대 범위로 지정하는 것이 좋을지
`ex) 입력에 대한 내용이 Long 범위를 넘어간다면 예외 처리`~~

#2 ~~요구사항 중, `numbers`의 접근제어자가 `private`인 것의 의미에 대하여~~

#3 ~~`IllegalStateException`이 발생하는 상황들에 대해~~

#4 ~~enum 클래스를 활용하는 것에 대해~~

#5 ~~검증 과정을 service로 옮겼을 때 입력을 다시 받을 수 있을 것인지~~

### 생각 해본 뒤(After)

  #1 -> 코드 리뷰 과정에서 인상 깊게 보았던 "나만의 요구사항"은 인상깊었지만, 내부적으로 어떤 테스트가 있을지 모르기 때문에
  섣불리 내가 임의로 값 제한을 두기 어렵다고 생각해서. 이번에도 BigInteger을 사용했고, 이번에 BigDecimal에 접근하는데 도움이 되었다.
  
  #2 -> 아무래도 함수로 엔티티에 접근하거나, 수정하는 경우를 방지하기 위한 것이라고 생각되었고. numbers를 얻기 위해 getter를 작성하였다.
  
  #3 -> 예외 상황들에 대해 아직 자세히 알지 못해서 그런 것인지 모르겠지만, 과제 요구사항에서 `IllegalStateException`이 일어나는 상황에
  대해서도 있다면 처리하라는 듯이 보였지만. 이는 중복적인 작업이 허용되는 상황에서만 발생하게 될 것 같아서, 이번 과제에서
  내가 보았을 때에는 `NumberFormatException`과 `IllegalArgumentException` 외의 오류 사항은 확인하지 못하였다.
  
  #4 -> 예외 메세지를 enum으로 관리하는 것 자체는 어느 정도 처음부터 하고자 했지만, 이번 미션에서는 Exception의 호출과
  메세지의 출력 또한 enum에서 하고자 하였는데, exception을 매개변수로 받아 호출하는 과정이 부적절하였고 출력은
  OutputView에서 담당하는 것이 옳은 것 같다는 생각에 결국 오류 원인 메세지의 기본 폼을 열거하는 데에 그쳤다.
  하지만, LottoRank enum클래스를 다루면서 Enum의 이점에 대해 다시 한 번 깨우치게 되었다.
  
  #5 -> 검증이 controller에 있는 것은 부적절 하다는 생각이 들었고, 이를 service로 옮기게 되었는데,
  처음에는 걱정이 입력을 다시 받을 수 있을 것인지 였는데, try-catch문을 재귀 형태로 활용하여 구현하였더니
  큰 문제가 발생하지 않았다. 처음에는 while 무한 루프를 할까도 생각했지만 뚜렷한 목적이 없는
  while(1) 무한루프를 입력을 요구하는 컨트롤러에서 사용한다는 것은 부적적하다는 생각에 사용하지 않았다.

### 마무리하며
2주차의 회고를 진행하면서 다시 한번 도전하고자 한 테스트 코드의 활용이 오히려 이번 주차 과제의 목표가
되었는데, 테스트를 개발 과정 중에 함께 다루면서 도전하려니 평소보다 2배가 넘는 시간이 소요되었던 것 같다.
하지만 시간을 들인 만큼 여태까지 작성해왔던 테스트 코드 중 가장 많은 테스트가 나왔다.
컨트롤러 테스트는 입출력이 포함되어 있어 포함하지 않았음에도 불구하고 많은
전부 성공하게 되면서, 뿌듯함을 느꼈고, 기능을 구현할 때 마다 중간중간 계속 테스트를 돌려가면서
개발 과정을 진행하니 지난번에는 테스트가 주는 이점을 크게 느끼지 못하였는데 이번 과제를 통해
확실하게 이점을 느끼게 된 것 같았다.

또한, 이번 미션에서는 2주차에 했던 클래스 분리를 넘어 또 한번 클래스 분리를 시도하였는데,
Lotto는 로또를 구매하는 사람이 사용하게 되는 클래스라면, Store는 말 그대로 로또 협회(혹은 상점)이 되어
이번 주의 당첨 번호와 보너스 번호를 발표하고, 당첨 결과를 제공하는 등의 역할을 수행하였고,
처음으로 global 패키지를 도입하여 전반적으로 이루어 질 수 있는 내용들에 대해 통합하거나, 관리성을 높이고자 하였다.
이러한 과정을 다 거치고 난 후 과했나? 라는 생각이 들기도 하였는데, 코드 리뷰를 통해 다른 사람의 생각은 어떤지
한 번 들어보고 싶다는 생각이 들었다.