# java-lotto-precourse

---

# 1. 기능 요구 사항

### 로또 번호의 숫자 범위는 1~45까지이다.

### 1개의 로또를 발행할 때 중복되지 않는 6개의 숫자를 뽑는다

### 당첨 번호 추첨 시 중복되지 않는 숫자 6개와 보너스 번호 1개를 뽑는다.

### 당첨은 1등부터 5등까지 있다. 당첨 기준과 금액은 아래와 같다.

#### 1등: 6개 번호 일치 / 2,000,000,000원

#### 2등: 5개 번호 + 보너스 번호 일치 / 30,000,000원

#### 3등: 5개 번호 일치 / 1,500,000원

#### 4등: 4개 번호 일치 / 50,000원

#### 5등: 3개 번호 일치 / 5,000원

### 로또 구입 금액을 입력하면 구입 금액에 해당하는 만큼 로또를 발행해야 한다.

### 로또 1장의 가격은 1,000원이다.

### 당첨 번호와 보너스 번호를 입력받는다.

### 사용자가 구매한 로또 번호와 당첨 번호를 비교하여 당첨 내역 및 수익률을 출력하고 로또 게임을 종료한다.

### 사용자가 잘못된 값을 입력할 경우 IllegalArgumentException을 발생시키고, "[ERROR]"로 시작하는 에러 메시지를 출력 후 그 부분부터 입력을 다시 받는다.

### Exception이 아닌 IllegalArgumentException, IllegalStateException 등과 같은 명확한 유형을 처리한다.

---

# 2. 전체적 설계 방향

## 책임 연쇄 패턴을 이용하여 구현

#### 책임 연쇄 패턴 변형

- 하나의 핸들러는 nextHanlder를 갖는다.
- validation에 포함하는 핸들러는 prevHandler를 갖는다.
- 입력 다음 validation을 추가하여, 입력값을 검증한다.
- `validation에서 입력값 예외 발생 시 prevHandler를 실행시켜, 입력으로 돌아갈 수 있다.`

## 핸들러 토큰

#### 핸들러 토큰 구조

- 핸들러 토큰은 TokenType(어떤 핸들러에서 사용되는가?, TokenType)과 Content(실질적인 데이터, Object)를 갖는다.
- 토큰은 입력과 생성된 값들을 다른 핸들러들로 이동시킬 수 있는 유일한 객체이다.
- HashMap<TokenType, Object> 형태로 TokenType에 따라, 모든 타입의 값을 가져올 수 있다.
- Object에서 특정 타입으로 캐스팅하기 위해서는 클래스 타입이 필요하다.
- `안전한 캐스팅을 위해서 DTO를 만들어, 핸들러 토큰에 추가해야한다.`

#### 핸들러 토큰 타입

- 핸들러 토큰 타입을 해시 맵의 키로 하여, DTO를 가져올 수 있다.
    - (입력) : 사용자 입력받은 값을 담는다.
    - (생성) : 프로그램에서 입력값을 통해 생성한 값을 담는다.
- `PURCHASE_AMOUNT_DTO : (입력) 구매 금액을 담는 DTO`
- `LOTTOS_DTO : (생성) 구매한 로또들을 리스트로 담는 DTO`
- `WINNING_NUMBER_DTO : (입력) 당첨 번호와 보너스 번호를 담는 DTO`
- `RANK_COUNTS_DTO : (생성) 해시맵으로 당첨 등수와 해당 등수의 갯수를 담는 DTO`
- `PROFIT_RATE_DTO : (생성) 계산된 수익률을 문자열로 담는 DTO`
- `INVALID_INPUT_ERROR : (생성) 입력값에서 에러가 있을 시 생성된다. 에러가 생성되었는지만, 확인하기 때문에 값은 null이다.`

## 책임 순서

#### 1. 구매 금액 입력

#### 2. 입력 값 검증

#### 3. 구매 금액을 통해 여러개의 로또 생성

#### 4. 여러개의 로또 출력

#### 5. 당첨 번호, 보너스 번호 입력

#### 6. 당첨 번호, 보너스 번호를 통해 당첨 결과 생성

#### 7. 당첨 결과 출력

#### 8. 당첨 결과와 구매 급액을 통해 수익률 생성

#### 9. 수익률 출력

#### 10. EndHandler를 통해 핸들러 토큰 생명주기 끝남 체크

- `(주의)토큰 생명주기 체크가 없을 시 책임 연쇄는 무한 루프에 빠지거나 알 수 없는 에러가 날 수 있음`

---

# 3. 구현

## 핸들러(책임)